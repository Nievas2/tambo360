generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Unidad {
  kg
  litros
}

enum Moneda {
  USD
  EUR
  ARS
}

enum Categoria {
  quesos
  leches
}

enum TipoToken {
  verificacion
  recuperacion
}

model Usuario {
  idUsuario        String            @id @default(uuid())
  correo           String            @unique
  contrasena       String
  nombre           String            @db.VarChar(50)
  verificado       Boolean           @default(false)
  fechaCreacion    DateTime          @default(now())
  establecimientos Establecimiento[]
  tokens           VerificarToken[]
}

model Establecimiento {
  idEstablecimiento String           @id @default(uuid())
  nombre            String
  localidad         String
  provincia         String
  fechaCreacion     DateTime         @default(now())
  idUsuario         String
  usuario           Usuario          @relation(fields: [idUsuario], references: [idUsuario])
  loteProducciones  LoteProduccion[]
}

model Producto {
  idProducto       String           @id @default(uuid())
  nombre           String
  categoria        Categoria
  loteProducciones LoteProduccion[]
}

model LoteProduccion {
  idLote            String          @id @default(uuid())
  fechaProduccion   DateTime        @default(now())
  idProducto        String
  producto          Producto        @relation(fields: [idProducto], references: [idProducto])
  cantidad          Decimal
  unidad            Unidad
  idEstablecimiento String
  estado            Boolean
  establecimiento   Establecimiento @relation(fields: [idEstablecimiento], references: [idEstablecimiento])
  mermas            Merma[]
  costosDirectos    CostosDirecto[]
}

model Merma {
  idMerma       String         @id @default(uuid())
  descripcion   String
  cantidad      Decimal
  unidad        Unidad
  fechaCreacion DateTime       @default(now())
  idLote        String
  lote          LoteProduccion @relation(fields: [idLote], references: [idLote])
}

model CostosDirecto {
  idCostoDirecto String         @id @default(uuid())
  concepto       String
  monto          Decimal        @db.Decimal(10, 2)
  moneda         Moneda
  fechaCreacion  DateTime       @default(now())
  idLote         String
  lote           LoteProduccion @relation(fields: [idLote], references: [idLote])
}

model VerificarToken {
  tokenid   String    @id @default(uuid())
  idUsuario String
  usuario   Usuario   @relation(fields: [idUsuario], references: [idUsuario])
  tipo      TipoToken
  tokenHash String
  expiraEn  DateTime
  usadoEn   DateTime?
  creadoEn  DateTime  @default(now())

  @@index([idUsuario, tipo])
}
